{% extends "base.html" %}

{% block title %}Dashboard - TiK√≤b{% endblock %}

{% block content %}

<!-- Welcome Hero with Haitian Proverb -->
<div class="hero-lakou mb-4 animate-in" data-aos="fade-down">
    <div class="row align-items-center">
        <div class="col-lg-8">
            <h1 class="hero-title mb-2">
                {% if language == 'ht' %}Byenveni, {{ session.username }}!{% else %}Welcome back, {{ session.username }}!{% endif %}
            </h1>
            <div class="pwov√®b mb-0">
                {{ proverb.text }}
                {% if proverb.meaning %}
                    <span class="pwov√®b-meaning">{{ proverb.meaning }}</span>
                {% endif %}
            </div>
        </div>
        <div class="col-lg-4 text-center d-none d-lg-block">
            <div class="animate-float">
                <img src="{{ url_for('static', filename='images/haiti-emblem.svg') }}" alt="TiK√≤b" style="width: 120px; height: 120px; filter: drop-shadow(0 4px 12px rgba(255, 159, 28, 0.3));">
            </div>
        </div>
    </div>
</div>

<!-- Survey Prompt for New Users -->
{% if not has_survey %}
<div class="lakou-card-featured mb-4 animate-in" data-aos="fade-up" style="background: linear-gradient(135deg, rgba(255, 159, 28, 0.1) 0%, rgba(46, 196, 182, 0.08) 100%); border: 2px solid var(--mango);">
    <div class="d-flex align-items-center gap-3">
        <div style="font-size: 2.5rem;">üìã</div>
        <div class="flex-grow-1">
            <h5 class="lakou-heading mb-1">{% if language == 'ht' %}Konplete Sondaj Finansye Ou{% else %}Complete Your Financial Survey{% endif %}</h5>
            <p class="lakou-body mb-0" style="color: var(--text-secondary);">
                {% if language == 'ht' %}Jwenn rek√≤mandasyon gwoup p√®sonalize ak kons√®y finansye.{% else %}Get personalized group recommendations and financial insights.{% endif %}
            </p>
        </div>
        <a href="{{ url_for('financial_survey') }}" class="btn-konbit btn-konbit-primary">
            {% if language == 'ht' %}K√≤manse{% else %}Start{% endif %} ‚Üí
        </a>
    </div>
</div>
{% endif %}

<!-- Quick Actions - Konbit Style -->
<div class="lakou-card mb-4" data-aos="fade-up" data-aos-delay="100">
    <h5 class="lakou-heading mb-3 d-flex align-items-center gap-2">
        <span>‚ö°</span> {% if language == 'ht' %}Aksyon Rapid{% else %}Quick Actions{% endif %}
    </h5>
    <div class="row g-3 stagger-in">
        <div class="col-md-3 col-6">
            <a href="{{ url_for('create_group') }}" class="lakou-card h-100 text-decoration-none text-center interactive-tap">
                <div style="font-size: 2.5rem;" class="mb-2">‚ûï</div>
                <span class="lakou-body d-block">{% if language == 'ht' %}Kreye Gwoup{% else %}Create Group{% endif %}</span>
            </a>
        </div>
        <div class="col-md-3 col-6">
            <a href="{{ url_for('join_group') }}" class="lakou-card h-100 text-decoration-none text-center interactive-tap">
                <div style="font-size: 2.5rem;" class="mb-2">ü§ù</div>
                <span class="lakou-body d-block">{% if language == 'ht' %}Jwenn Gwoup{% else %}Join Group{% endif %}</span>
            </a>
        </div>
        <div class="col-md-3 col-6">
            <a href="{{ url_for('leaderboard') }}" class="lakou-card h-100 text-decoration-none text-center interactive-tap">
                <div style="font-size: 2.5rem;" class="mb-2">üèÜ</div>
                <span class="lakou-body d-block">{% if language == 'ht' %}Lid√® yo{% else %}Leaderboard{% endif %}</span>
            </a>
        </div>
        <div class="col-md-3 col-6">
            <a href="{{ url_for('my_badges') }}" class="lakou-card h-100 text-decoration-none text-center interactive-tap">
                <div style="font-size: 2.5rem;" class="mb-2">üèÖ</div>
                <span class="lakou-body d-block">{% if language == 'ht' %}Badj Mwen{% else %}My Badges{% endif %}</span>
            </a>
        </div>
    </div>
</div>

<!-- Stats Overview -->
{% if advice %}
<div class="row mb-4 stagger-in" data-aos="fade-up" data-aos-delay="200">
    <div class="col-md-4 mb-3">
        <div class="lakou-card text-center h-100">
            <div class="stat-circle mx-auto mb-3">
                <span class="stat-value">${{ "%.0f"|format(advice.total_saved) }}</span>
            </div>
            <p class="lakou-body mb-0" style="color: var(--text-secondary);">
                {% if language == 'ht' %}Total Ekonomize{% else %}Total Saved{% endif %}
            </p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="lakou-card text-center h-100">
            <div class="stat-circle mx-auto mb-3">
                <span class="stat-value">{{ advice.groups_count }}</span>
            </div>
            <p class="lakou-body mb-0" style="color: var(--text-secondary);">
                {% if language == 'ht' %}Gwoup Aktif{% else %}Active Groups{% endif %}
            </p>
        </div>
    </div>
    <div class="col-md-4 mb-3">
        <div class="lakou-card text-center h-100">
            <div class="stat-circle mx-auto mb-3 animate-pulse-warm">
                <span class="stat-value">{{ "%.0f"|format(advice.next_goal.progress) }}%</span>
            </div>
            <p class="lakou-body mb-0" style="color: var(--text-secondary);">
                {% if language == 'ht' %}Pwogr√® Objektif{% else %}Goal Progress{% endif %}
            </p>
            <div class="mt-3 px-4">
                <div class="progress-lakou">
                    <div class="progress-lakou-bar" style="width: {{ "%.0f"|format(advice.next_goal.progress if advice.next_goal.progress <= 100 else 100) }}%"></div>
                </div>
                <small class="lakou-body d-block mt-2" style="color: var(--text-secondary);">
                    {% if language == 'ht' %}Objektif{% else %}Target{% endif %}: ${{ advice.next_goal.amount }}
                </small>
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Section Divider -->
<div class="story-section">
    <div class="story-intro">
        <h2>{% if language == 'ht' %}Gwoup Ekonomi Mwen yo{% else %}My Savings Groups{% endif %}</h2>
        <p>{% if language == 'ht' %}Ansanm nou pi f√≤. Men gwoup kote ou f√® pati a.{% else %}Together we are stronger. Here are the groups you belong to.{% endif %}</p>
    </div>
</div>

<!-- Groups Grid -->
<div class="row">
    <div class="col-12">        
        {% if groups_data %}
            <div class="row stagger-in">
                {% for data in groups_data %}
                <div class="col-md-6 col-lg-4 mb-4" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 50 }}">
                    <div class="lakou-card lakou-card-featured h-100">
                        <!-- Group Header -->
                        <div class="text-center pb-3 mb-3" style="border-bottom: 2px solid rgba(255, 159, 28, 0.2);">
                            <div style="font-size: 3rem;" class="mb-2 animate-float">
                                {% if data.group.tradition %}
                                    {{ data.group.tradition.icon }}
                                {% else %}
                                    üí∞
                                {% endif %}
                            </div>
                            <h5 class="lakou-heading mb-1">{{ data.group.name }}</h5>
                            <p class="lakou-body small mb-0" style="color: var(--text-secondary);">
                                {{ data.group.description[:50] + '...' if data.group.description and data.group.description|length > 50 else data.group.description or 'No description' }}
                            </p>
                        </div>
                        
                        <!-- Group Stats -->
                        <div class="mb-3">
                            <div class="d-flex align-items-center gap-3 mb-2 p-2" style="background: rgba(255, 159, 28, 0.05); border-radius: 8px;">
                                <span style="font-size: 1.5rem;">üíµ</span>
                                <div>
                                    <div class="lakou-body fw-bold">${{ "%.2f"|format(data.group.contribution_amount) }}</div>
                                    <small style="color: var(--text-secondary);">per {{ data.group.contribution_frequency }}</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3 mb-2 p-2" style="background: rgba(46, 196, 182, 0.05); border-radius: 8px;">
                                <span style="font-size: 1.5rem;">üë•</span>
                                <div>
                                    <div class="lakou-body fw-bold">{{ data.members_count }} {% if language == 'ht' %}manm{% else %}members{% endif %}</div>
                                    <small style="color: var(--text-secondary);">{% if language == 'ht' %}nan gwoup la{% else %}in this group{% endif %}</small>
                                </div>
                            </div>
                            <div class="d-flex align-items-center gap-3 p-2" style="background: rgba(45, 90, 39, 0.05); border-radius: 8px;">
                                <span style="font-size: 1.5rem;">üíé</span>
                                <div>
                                    <div class="lakou-body fw-bold" style="color: var(--palm-green);">${{ "%.2f"|format(data.balance) }}</div>
                                    <small style="color: var(--text-secondary);">{% if language == 'ht' %}balans gwoup{% else %}group balance{% endif %}</small>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Role Badge -->
                        <div class="mb-3 text-center">
                            <span class="badge-cultural {% if data.membership.role == 'admin' %}badge-mango{% else %}badge-ocean{% endif %}">
                                {% if data.membership.role == 'admin' %}üëë{% else %}ü§ù{% endif %}
                                {{ data.membership.role|upper }}
                            </span>
                        </div>
                        
                        <!-- Progress Bar -->
                        {% set target = data.group.contribution_amount * data.members_count * 10 %}
                        {% set progress = (data.balance / target * 100) if target > 0 else 0 %}
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <small class="lakou-body" style="color: var(--text-secondary);">{% if language == 'ht' %}Pwogr√®{% else %}Progress{% endif %}</small>
                                <small class="lakou-body fw-bold">${{ "%.0f"|format(target) }}</small>
                            </div>
                            <div class="progress-lakou">
                                <div class="progress-lakou-bar" style="width: {{ "%.0f"|format(progress if progress <= 100 else 100) }}%"></div>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('group_detail', group_id=data.group.id) }}" class="btn-konbit btn-konbit-primary">
                                {% if language == 'ht' %}W√® Detay{% else %}View Details{% endif %}
                            </a>
                            <a href="{{ url_for('ledger', group_id=data.group.id) }}" class="btn-konbit btn-konbit-secondary">
                                {% if language == 'ht' %}W√® Liv Kont{% else %}View Ledger{% endif %}
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <!-- Empty State -->
            <div class="lakou-card text-center" data-aos="fade-up">
                <div class="py-5">
                    <div style="font-size: 5rem;" class="mb-4 animate-float">üå±</div>
                    <h3 class="lakou-heading mb-3">
                        {% if language == 'ht' %}K√≤manse Vwayaj Ekonomi Ou{% else %}Start Your Savings Journey{% endif %}
                    </h3>
                    <p class="lakou-body mx-auto mb-4" style="max-width: 500px; color: var(--text-secondary);">
                        {% if language == 'ht' %}
                        Ou poko nan okenn gwoup ekonomi. K√≤manse jodi a - kreye yon gwoup oswa jwenn youn ki egziste.
                        {% else %}
                        You haven't joined any savings groups yet. Get started today - create a new group or join an existing one.
                        {% endif %}
                    </p>
                    <div class="pwov√®b mx-auto mb-4" style="max-width: 600px;">
                        {% if language == 'ht' %}
                        "Men anpil, chay pa lou" ‚Äî Ansanm, nou ka reyisi plis pase poukont nou.
                        {% else %}
                        "Many hands make the load lighter" ‚Äî Together, we can achieve more than alone.
                        {% endif %}
                    </div>
                    <div class="d-flex gap-3 justify-content-center flex-wrap">
                        <a href="{{ url_for('create_group') }}" class="btn-konbit btn-konbit-primary">
                            ‚ûï {% if language == 'ht' %}Kreye Gwoup{% else %}Create Group{% endif %}
                        </a>
                        <a href="{{ url_for('join_group') }}" class="btn-konbit btn-konbit-secondary">
                            ü§ù {% if language == 'ht' %}Jwenn Gwoup{% else %}Join Group{% endif %}
                        </a>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
</div>

{% endblock %}
