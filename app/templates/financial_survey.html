{% extends "base.html" %}

{% block title %}Financial Profile Survey - TiKÃ²b{% endblock %}

{% block content %}

<!-- Animated Background Particles -->
<div class="particles-bg">
    <div class="particle" style="width: 250px; height: 250px; left: 5%; top: 15%; animation-delay: 0s;"></div>
    <div class="particle" style="width: 180px; height: 180px; right: 10%; top: 50%; animation-delay: 4s;"></div>
    <div class="particle" style="width: 120px; height: 120px; left: 75%; top: 25%; animation-delay: 7s;"></div>
</div>

<div class="survey-container">
    <div class="text-center mb-4" data-aos="fade-down">
        <h1 class="premium-heading">ğŸ“Š Financial Profile Survey</h1>
        <p class="text-muted premium-body">Help us understand your goals to find your perfect savings group</p>
    </div>
    
    <!-- Progress Bar -->
    <div class="survey-progress" data-aos="fade-up" data-aos-delay="100">
        <div class="d-flex justify-content-between mb-2">
            <span class="small text-muted">Progress</span>
            <span class="small premium-subheading" id="progressText">Question 1 of 9</span>
        </div>
        <div class="survey-progress-bar">
            <div class="survey-progress-fill" id="progressBar" style="width: 11%"></div>
        </div>
    </div>
    
    <!-- Survey Form -->
    <form method="POST" action="{{ url_for('submit_financial_survey') }}" id="surveyForm">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        
        <!-- Question 1: Income Range -->
        <div class="survey-step step-active" data-step="1" data-aos="fade-up" data-aos-delay="200">
            <h3 class="survey-question">What is your monthly income range?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="under_1000">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’µ</span>
                    <span>Under $1,000</span>
                </div>
                <div class="survey-option" data-value="1000_2500">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’°</span>
                    <span>$1,000 - $2,500</span>
                </div>
                <div class="survey-option" data-value="2500_5000">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’¸</span>
                    <span>$2,500 - $5,000</span>
                </div>
                <div class="survey-option" data-value="5000_7500">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’</span>
                    <span>$5,000 - $7,500</span>
                </div>
                <div class="survey-option" data-value="7500_10000">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ†</span>
                    <span>$7,500 - $10,000</span>
                </div>
                <div class="survey-option" data-value="over_10000">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘‘</span>
                    <span>Over $10,000</span>
                </div>
            </div>
            <input type="hidden" name="income_range" id="income_range" required>
        </div>
        
        <!-- Question 2: Savings Habit -->
        <div class="survey-step" data-step="2" style="display: none;">
            <h3 class="survey-question">How would you describe your savings habit?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="none">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ˜…</span>
                    <span>I don't save regularly</span>
                </div>
                <div class="survey-option" data-value="occasional">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ¤”</span>
                    <span>I save occasionally when I have extra money</span>
                </div>
                <div class="survey-option" data-value="monthly">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ“…</span>
                    <span>I save a small amount each month</span>
                </div>
                <div class="survey-option" data-value="consistent">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">âœ…</span>
                    <span>I save consistently every month</span>
                </div>
                <div class="survey-option" data-value="aggressive">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸš€</span>
                    <span>I save aggressively (20%+ of income)</span>
                </div>
            </div>
            <input type="hidden" name="savings_habit" id="savings_habit" required>
        </div>
        
        <!-- Question 3: Financial Goal -->
        <div class="survey-step" data-step="3" style="display: none;">
            <h3 class="survey-question">What is your primary financial goal?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="emergency_fund">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ›¡ï¸</span>
                    <span>Build an emergency fund</span>
                </div>
                <div class="survey-option" data-value="debt_payoff">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’³</span>
                    <span>Pay off debt</span>
                </div>
                <div class="survey-option" data-value="major_purchase">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ </span>
                    <span>Save for a major purchase (home, car, etc.)</span>
                </div>
                <div class="survey-option" data-value="education">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ“</span>
                    <span>Education expenses</span>
                </div>
                <div class="survey-option" data-value="business">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’¼</span>
                    <span>Start or grow a business</span>
                </div>
                <div class="survey-option" data-value="retirement">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸŒ´</span>
                    <span>Retirement savings</span>
                </div>
                <div class="survey-option" data-value="wealth_building">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ“ˆ</span>
                    <span>Long-term wealth building</span>
                </div>
            </div>
            <input type="hidden" name="financial_goal" id="financial_goal" required>
        </div>
        
        <!-- Question 4: Risk Tolerance -->
        <div class="survey-step" data-step="4" style="display: none;">
            <h3 class="survey-question">How would you describe your risk tolerance?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="very_low">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ¢</span>
                    <span>Very Low - I need guaranteed safety</span>
                </div>
                <div class="survey-option" data-value="low">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸŒ±</span>
                    <span>Low - I prefer minimal risk</span>
                </div>
                <div class="survey-option" data-value="moderate">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">âš–ï¸</span>
                    <span>Moderate - I can handle some ups and downs</span>
                </div>
                <div class="survey-option" data-value="high">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ¢</span>
                    <span>High - I'm comfortable with volatility</span>
                </div>
            </div>
            <input type="hidden" name="risk_tolerance" id="risk_tolerance" required>
        </div>
        
        <!-- Question 5: Employment Status -->
        <div class="survey-step" data-step="5" style="display: none;">
            <h3 class="survey-question">What is your current employment status?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="full_time">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’¼</span>
                    <span>Full-time employed</span>
                </div>
                <div class="survey-option" data-value="part_time">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">â°</span>
                    <span>Part-time employed</span>
                </div>
                <div class="survey-option" data-value="self_employed">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸš€</span>
                    <span>Self-employed/Freelancer</span>
                </div>
                <div class="survey-option" data-value="unemployed">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ”</span>
                    <span>Currently unemployed</span>
                </div>
                <div class="survey-option" data-value="student">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ“š</span>
                    <span>Student</span>
                </div>
                <div class="survey-option" data-value="retired">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ–ï¸</span>
                    <span>Retired</span>
                </div>
            </div>
            <input type="hidden" name="employment_status" id="employment_status" required>
        </div>
        
        <!-- Question 6: Dependents -->
        <div class="survey-step" data-step="6" style="display: none;">
            <h3 class="survey-question">How many financial dependents do you have?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="0">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ™‹</span>
                    <span>0 - Just me</span>
                </div>
                <div class="survey-option" data-value="1">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¥</span>
                    <span>1 dependent</span>
                </div>
                <div class="survey-option" data-value="2">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</span>
                    <span>2 dependents</span>
                </div>
                <div class="survey-option" data-value="3">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                    <span>3 dependents</span>
                </div>
                <div class="survey-option" data-value="4">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘§</span>
                    <span>4+ dependents</span>
                </div>
            </div>
            <input type="hidden" name="dependents" id="dependents" required>
        </div>
        
        <!-- Question 7: Emergency Fund -->
        <div class="survey-step" data-step="7" style="display: none;">
            <h3 class="survey-question">Do you currently have an emergency fund?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="yes">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">âœ…</span>
                    <span>Yes - I have 3+ months of expenses saved</span>
                </div>
                <div class="survey-option" data-value="partial">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">âš ï¸</span>
                    <span>Partially - I have some savings but less than 3 months</span>
                </div>
                <div class="survey-option" data-value="no">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">âŒ</span>
                    <span>No - I don't have emergency savings</span>
                </div>
            </div>
            <input type="hidden" name="has_emergency_fund" id="has_emergency_fund" required>
        </div>
        
        <!-- Question 8: Group Size -->
        <div class="survey-step" data-step="8" style="display: none;">
            <h3 class="survey-question">What size savings group would you prefer?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="small">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¥</span>
                    <span>Small (5-10 members) - More intimate, easier to manage</span>
                </div>
                <div class="survey-option" data-value="medium">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘«</span>
                    <span>Medium (11-20 members) - Balanced community</span>
                </div>
                <div class="survey-option" data-value="large">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
                    <span>Large (21+ members) - Bigger pools, more diversity</span>
                </div>
                <div class="survey-option" data-value="no_preference">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ¤·</span>
                    <span>No preference</span>
                </div>
            </div>
            <input type="hidden" name="preferred_group_size" id="preferred_group_size" required>
        </div>
        
        <!-- Question 9: Contribution Comfort -->
        <div class="survey-step" data-step="9" style="display: none;">
            <h3 class="survey-question">How much are you comfortable contributing per month?</h3>
            <div class="survey-options">
                <div class="survey-option" data-value="under_50">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’µ</span>
                    <span>Under $50/month</span>
                </div>
                <div class="survey-option" data-value="50_100">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’°</span>
                    <span>$50 - $100/month</span>
                </div>
                <div class="survey-option" data-value="100_250">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’¸</span>
                    <span>$100 - $250/month</span>
                </div>
                <div class="survey-option" data-value="250_500">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ’</span>
                    <span>$250 - $500/month</span>
                </div>
                <div class="survey-option" data-value="over_500">
                    <span style="font-size: 1.5rem; margin-right: 0.75rem;">ğŸ‘‘</span>
                    <span>Over $500/month</span>
                </div>
            </div>
            <input type="hidden" name="contribution_comfort_level" id="contribution_comfort_level" required>
        </div>
        
        <!-- Navigation Buttons -->
        <div class="mt-4 d-flex justify-content-between align-items-center">
            <button type="button" class="btn-premium" id="prevBtn" style="display: none; opacity: 0.7;">
                â† Previous
            </button>
            <span></span>
            <button type="button" class="btn-premium" id="nextBtn">
                Next â†’
            </button>
            <button type="submit" class="btn-premium btn-premium-gold" id="submitBtn" style="display: none;">
                Get My Recommendations âœ¨
            </button>
        </div>
    </form>
    
    <div class="text-center mt-4">
        <a href="{{ url_for('dashboard') }}" class="text-muted small">Skip for now</a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Multi-step survey logic
    let currentStep = 1;
    const totalSteps = 9;
    const stepData = {};

    // Update progress bar
    function updateProgress() {
        const progress = (currentStep / totalSteps) * 100;
        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('progressText').textContent = `Question ${currentStep} of ${totalSteps}`;
    }

    // Show specific step
    function showStep(stepNumber) {
        document.querySelectorAll('.survey-step').forEach(step => {
            step.style.display = 'none';
            step.classList.remove('step-active');
        });
        
        const currentStepEl = document.querySelector(`[data-step="${stepNumber}"]`);
        if (currentStepEl) {
            currentStepEl.style.display = 'block';
            setTimeout(() => currentStepEl.classList.add('step-active'), 10);
        }
        
        // Update button visibility
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        
        if (prevBtn) prevBtn.style.display = stepNumber > 1 ? 'block' : 'none';
        if (nextBtn) nextBtn.style.display = stepNumber < totalSteps ? 'block' : 'none';
        if (submitBtn) submitBtn.style.display = stepNumber === totalSteps ? 'block' : 'none';
        
        updateProgress();
    }

    // Handle option selection
    document.querySelectorAll('.survey-option').forEach(option => {
        option.addEventListener('click', function() {
            const step = this.closest('.survey-step');
            const stepNum = parseInt(step.getAttribute('data-step'));
            const value = this.getAttribute('data-value');
            
            // Remove selected class from siblings
            step.querySelectorAll('.survey-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            
            // Add selected class
            this.classList.add('selected');
            
            // Get the field name from the step
            const fieldNames = [
                'income_range', 'savings_habit', 'financial_goal', 'risk_tolerance',
                'employment_status', 'dependents', 'has_emergency_fund',
                'preferred_group_size', 'contribution_comfort_level'
            ];
            const fieldName = fieldNames[stepNum - 1];
            
            // Store value in hidden input
            const hiddenInput = document.getElementById(fieldName);
            if (hiddenInput) {
                hiddenInput.value = value;
                console.log(`Set ${fieldName} = ${value}`); // Debug log
            } else {
                console.error(`Hidden input not found: ${fieldName}`); // Debug log
            }
            
            // Store in stepData
            stepData[fieldName] = value;
            
            // Auto-advance after a short delay for better UX
            setTimeout(() => {
                if (currentStep < totalSteps) {
                    currentStep++;
                    showStep(currentStep);
                }
            }, 400);
        });
    });

    // Previous button
    const prevBtn = document.getElementById('prevBtn');
    if (prevBtn) {
        prevBtn.addEventListener('click', function() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
            }
        });
    }

    // Next button (if user wants to skip or go back)
    const nextBtn = document.getElementById('nextBtn');
    if (nextBtn) {
        nextBtn.addEventListener('click', function() {
            if (currentStep < totalSteps) {
                currentStep++;
                showStep(currentStep);
            }
        });
    }

    // Form submission with confetti
    const surveyForm = document.getElementById('surveyForm');
    if (surveyForm) {
        surveyForm.addEventListener('submit', function(e) {
            // Validate all fields are filled
            let allFilled = true;
            const fieldNames = [
                'income_range', 'savings_habit', 'financial_goal', 'risk_tolerance',
                'employment_status', 'dependents', 'has_emergency_fund',
                'preferred_group_size', 'contribution_comfort_level'
            ];
            
            fieldNames.forEach(fieldName => {
                const hiddenInput = document.getElementById(fieldName);
                if (!hiddenInput || !hiddenInput.value) {
                    console.error(`Missing value for: ${fieldName}`);
                    allFilled = false;
                }
            });
            
            if (!allFilled) {
                e.preventDefault();
                alert('Please answer all questions before submitting.');
                return false;
            }
            
            // Show confetti celebration
            confetti({
                particleCount: 100,
                spread: 70,
                origin: { y: 0.6 },
                colors: ['#667eea', '#764ba2', '#f093fb', '#FFD700']
            });
        });
    }

    // Initialize
    showStep(1);
});
</script>

{% endblock %}
